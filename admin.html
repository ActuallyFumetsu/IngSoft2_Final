<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administrador</title>
  <link rel="stylesheet" href="style.css">
  <style>
    table {
      margin: 20px auto;
      width: 90%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    input, select {
      width: 90%;
    }
    button {
      margin: 4px;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>Gestión de Usuarios</h1>

    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Contraseña</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="user-table-body"></tbody>
    </table>

    <h3>Agregar Nuevo Usuario</h3>
    <input type="text" id="new-username" placeholder="Usuario">
    <input type="password" id="new-password" placeholder="Contraseña">
    <select id="new-role">
      <option value="usuario">Usuario</option>
      <option value="empleado">Empleado</option>
      <option value="admin">Administrador</option>
    </select>
    <button onclick="agregarUsuario()">Agregar</button>

    <br><br>
    <a href="#" onclick="cerrarSesion()">Cerrar sesión</a>
  </div>

  <script>
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

    function mostrarUsuarios() {
      const tbody = document.getElementById("user-table-body");
      tbody.innerHTML = "";
      usuarios.forEach((user, index) => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td><input type="text" value="${user.username}" onchange="editarCampo(${index}, 'username', this.value)"></td>
          <td><input type="password" value="${user.password}" onchange="editarCampo(${index}, 'password', this.value)"></td>
          <td>
            <select onchange="editarCampo(${index}, 'rol', this.value)">
              <option value="usuario" ${user.rol === 'usuario' ? 'selected' : ''}>Usuario</option>
              <option value="empleado" ${user.rol === 'empleado' ? 'selected' : ''}>Empleado</option>
              <option value="admin" ${user.rol === 'admin' ? 'selected' : ''}>Administrador</option>
            </select>
          </td>
          <td>
            <button onclick="eliminarUsuario(${index})">Eliminar</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      guardarUsuarios();
    }

    function editarCampo(index, campo, valor) {
      usuarios[index][campo] = valor;
      guardarUsuarios();
    }

    function eliminarUsuario(index) {
      if (confirm("¿Estás seguro de eliminar este usuario?")) {
        usuarios.splice(index, 1);
        mostrarUsuarios();
      }
    }

    function agregarUsuario() {
      const username = document.getElementById("new-username").value.trim();
      const password = document.getElementById("new-password").value.trim();
      const rol = document.getElementById("new-role").value;

      if (username && password) {
        usuarios.push({ username, password, rol });
        document.getElementById("new-username").value = "";
        document.getElementById("new-password").value = "";
        mostrarUsuarios();
      } else {
        alert("Debes completar usuario y contraseña.");
      }
    }

    function guardarUsuarios() {
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
    }

    function cerrarSesion() {
      localStorage.removeItem("usuarioActual");
      window.location.href = "index.html";
    }

    // Seguridad básica: solo admin puede entrar
    const actual = JSON.parse(localStorage.getItem("usuarioActual"));
    if (!actual || actual.rol !== "admin") {
      alert("Acceso no autorizado.");
      window.location.href = "index.html";
    } else {
      mostrarUsuarios();
    }
  </script>
</body>
</html>
